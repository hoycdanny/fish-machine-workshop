# 服務驗證和容器化實施計劃

## 概述

本實施計劃將指導開發者逐步驗證現有的魚機遊戲微服務，將其容器化，並推送到 AWS ECR，為後續的 EKS 部署做準備。

## 任務清單

- [x] 1. 環境準備和服務探索





  - 驗證開發環境已正確設定
  - 探索現有的微服務程式碼結構


  - 確認所有必要工具已安裝
  - _需求: 1.1, 1.3, 1.4_


- [ ] 2. Client Service 驗證和測試
  - [ ] 2.1 分析 Client Service 程式碼結構
    - 檢查 package.json 和依賴項
    - 理解服務的啟動方式和配置
    - 識別靜態資源和 API 端點
    - _需求: 2.1_

  - [ ] 2.2 本地啟動 Client Service
    - 安裝 Node.js 依賴項
    - 配置環境變數
    - 啟動服務並驗證端口 8080 可訪問
    - _需求: 2.1_



  - [ ] 2.3 測試 Client Service 功能
    - 驗證健康檢查端點 /health
    - 測試靜態資源載入
    - 驗證 WebSocket 連接功能
    - _需求: 2.1_

- [ ] 3. Game Session Service 驗證和測試
  - [ ] 3.1 分析 Game Session Service 程式碼
    - 檢查服務依賴和配置
    - 理解會話管理邏輯
    - 識別 API 端點和數據模型
    - _需求: 2.2_

  - [ ] 3.2 本地啟動 Game Session Service
    - 安裝必要依賴項
    - 配置服務端口 8082
    - 啟動服務並驗證可訪問性




    - _需求: 2.2_

  - [ ] 3.3 測試 Game Session Service API
    - 測試會話創建 API
    - 測試玩家加入會話功能
    - 驗證會話狀態管理
    - _需求: 2.2_

- [ ] 4. Game Server Service 驗證和測試
  - [ ] 4.1 分析 Game Server Service 程式碼
    - 檢查遊戲邏輯實現
    - 理解 WebSocket 處理機制
    - 識別積分系統和遊戲規則
    - _需求: 2.3_

  - [ ] 4.2 本地啟動 Game Server Service
    - 安裝服務依賴項
    - 配置服務端口 8083
    - 啟動服務並驗證 WebSocket 功能
    - _需求: 2.3_

  - [ ] 4.3 測試 Game Server Service 功能
    - 測試遊戲邏輯處理
    - 驗證 WebSocket 實時通信
    - 測試積分計算和更新
    - _需求: 2.3_

- [ ] 5. 端到端整合測試
  - [ ] 5.1 同時啟動所有三個服務
    - 確保端口不衝突
    - 驗證服務間通信
    - 檢查服務依賴關係
    - _需求: 2.4_

  - [ ] 5.2 執行完整遊戲流程測試
    - 創建遊戲會話
    - 模擬玩家加入和遊戲
    - 驗證實時通信和積分更新
    - _需求: 2.4_

- [ ] 6. Docker 容器化實施
  - [ ] 6.1 為 Client Service 創建 Dockerfile
    - 選擇合適的基礎映像
    - 實施多階段構建優化
    - 配置非 root 用戶運行
    - 添加健康檢查配置
    - _需求: 3.1, 3.2_

  - [ ] 6.2 為 Game Session Service 創建 Dockerfile
    - 優化映像大小和安全性
    - 配置環境變數支援
    - 實施健康檢查機制
    - _需求: 3.1, 3.2_

  - [ ] 6.3 為 Game Server Service 創建 Dockerfile
    - 確保 WebSocket 功能正常
    - 優化容器啟動時間
    - 配置適當的資源限制
    - _需求: 3.1, 3.2_

  - [ ] 6.4 構建和測試所有容器映像
    - 構建每個服務的 Docker 映像
    - 驗證映像大小合理（< 500MB）
    - 測試容器啟動和健康檢查
    - _需求: 3.1, 3.2_

- [ ] 7. Docker Compose 編排設定
  - [ ] 7.1 創建 docker-compose.yml 配置
    - 定義所有三個服務
    - 配置服務間網路通信
    - 設定環境變數和端口映射
    - _需求: 3.3, 5.1_

  - [ ] 7.2 配置服務依賴和健康檢查
    - 定義服務啟動順序
    - 配置健康檢查參數
    - 設定重啟策略
    - _需求: 3.3, 5.2_

  - [ ] 7.3 測試 Docker Compose 環境
    - 使用 docker-compose up 啟動所有服務
    - 驗證服務間通信正常
    - 執行端到端功能測試
    - _需求: 3.3, 5.3_

- [ ] 8. AWS ECR 準備和配置
  - [ ] 8.1 創建 ECR 倉庫
    - 為每個服務創建獨立的 ECR 倉庫
    - 配置倉庫權限和生命週期政策
    - 驗證 IAM 權限設定
    - _需求: 4.1_

  - [ ] 8.2 配置 Docker 認證
    - 使用 AWS CLI 獲取 ECR 登入令牌
    - 配置 Docker 客戶端認證
    - 驗證可以推送到 ECR
    - _需求: 4.1_

- [ ] 9. 容器映像推送和標籤管理
  - [ ] 9.1 標籤和推送 Client Service 映像
    - 使用語義化版本標籤（v1.0.0）
    - 推送映像到對應的 ECR 倉庫
    - 驗證映像推送成功
    - _需求: 4.2, 4.3_

  - [ ] 9.2 標籤和推送 Game Session Service 映像
    - 應用一致的標籤策略
    - 推送到 ECR 並驗證
    - _需求: 4.2, 4.3_

  - [ ] 9.3 標籤和推送 Game Server Service 映像
    - 完成所有映像的 ECR 推送
    - 驗證所有映像可被拉取
    - _需求: 4.2, 4.3_

- [ ] 10. ECR 映像驗證和測試
  - [ ] 10.1 從 ECR 拉取映像測試
    - 清理本地映像
    - 從 ECR 拉取所有服務映像
    - 驗證拉取的映像功能正常
    - _需求: 4.4_

  - [ ] 10.2 使用 ECR 映像運行完整測試
    - 使用 ECR 映像更新 docker-compose.yml
    - 執行完整的端到端測試
    - 驗證所有功能正常運作
    - _需求: 4.4_

- [ ] 11. 文檔和腳本創建
  - [ ] 11.1 創建構建和部署腳本
    - 編寫自動化構建腳本
    - 創建 ECR 推送腳本
    - 實施版本管理腳本
    - _需求: 6.2, 6.3_

  - [ ] 11.2 編寫操作文檔
    - 創建服務驗證指南
    - 編寫容器化最佳實踐文檔
    - 提供故障排除指南
    - _需求: 6.1, 6.4_

  - [ ] 11.3 創建測試和驗證腳本
    - 編寫自動化測試腳本
    - 創建健康檢查腳本
    - 實施整合測試自動化
    - _需求: 6.3_

- [ ] 12. 最終驗證和清理
  - [ ] 12.1 執行完整的驗證測試
    - 運行所有自動化測試
    - 驗證所有需求已滿足
    - 檢查文檔完整性
    - _需求: 所有需求_

  - [ ] 12.2 環境清理和優化
    - 清理不需要的容器和映像
    - 優化資源使用
    - 準備 EKS 部署環境
    - _需求: 5.4_

## 執行注意事項

### 前置條件
- 開發環境已按照 Chapter 0 完成設定
- VS Code Server 可正常訪問
- AWS IAM Role 已正確配置
- 所有必要工具已安裝並驗證

### 執行順序
1. 必須按順序執行任務 1-5（服務驗證）
2. 任務 6-7（容器化）可以並行進行
3. 任務 8-10（ECR）需要在容器化完成後執行
4. 任務 11-12（文檔和驗證）可以與其他任務並行進行

### 品質檢查點
- 每個服務驗證完成後進行功能測試
- 每個 Dockerfile 創建後進行安全和大小檢查
- ECR 推送後進行映像完整性驗證
- 最終完成前進行端到端測試

### 故障排除
- 如果服務啟動失敗，檢查端口衝突和依賴項
- 如果容器構建失敗，檢查 Dockerfile 語法和基礎映像
- 如果 ECR 推送失敗，檢查 AWS 權限和網路連接
- 如果測試失敗，檢查服務配置和環境變數

這個實施計劃將確保所有微服務都經過充分驗證、正確容器化，並成功推送到 ECR，為後續的 EKS 部署奠定堅實基礎。